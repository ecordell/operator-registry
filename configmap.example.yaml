kind: ConfigMap
apiVersion: v1
metadata:
  name: openshift-olm-test
data:
  customResourceDefinitions: |-
    - apiVersion: apiextensions.k8s.io/v1beta1
      kind: CustomResourceDefinition
      metadata:
        name: elasticsearches.logging.openshift.io
      spec:
        group: logging.openshift.io
        names:
          kind: Elasticsearch
          listKind: ElasticsearchList
          plural: elasticsearches
          singular: elasticsearch
        scope: Namespaced
        version: v1
        validation:
          openAPIV3Schema:
            properties:
              spec:
                description: Specification of the desired behavior of the Elasticsearch cluster
                properties:
                  managementState:
                    description: Indicator if the resource is 'Managed' or 'Unmanaged' by the operator
                    type: string
                    enum:
                    - "Managed"
                    - "Unmanaged"
                  redundancyPolicy:
                    description: The policy towards data redundancy to specify the number of redundant primary shards
                    type: string
                    enum:
                    - "FullRedundancy"
                    - "MultipleRedundancy"
                    - "SingleRedundancy"
                    - "ZeroRedundancy"
                  nodes:
                    description: Specification of the different Elasticsearch nodes
                    type: array
                    items:
                      type: object
                      properties:
                        roles:
                          description: The specific Elasticsearch cluster roles the node should perform
                          type: array
                          items:
                            type: string
                        nodeCount:
                          description: Number of nodes to deploy
                          format: int32
                          type: integer
                        nodeSpec:
                          description: Specification of a specific Elasticsearch node
                          properties:
                            image:
                              description: The image to use for the Elasticsearch node
                              type: string
                            resources:
                              description: The resource requirements for the Elasticsearch node
                              properties:
                                limits:
                                  description: 'Limits describes the maximum amount of compute
                                    resources allowed. More info: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/'
                                  type: object
                                requests:
                                  description: 'Requests describes the minimum amount of compute
                                    resources required. If Requests is omitted for a container,
                                    it defaults to Limits if that is explicitly specified, otherwise
                                    to an implementation-defined value. More info: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/'
                                  type: object
                        nodeSelector:
                          description: Define which Nodes the Pods are scheduled on.
                          type: object
                        storage:
                          description: The type of backing storage that should be used for the node
                          properties:
                            storageClassName:
                              description: The name of the storage class to use with creating the node's PVC
                              type: string
                            size:
                              description: The max storage capacity for the node
                              type: string
                  nodeSpec:
                    description: Default specification applied to all Elasticsearch nodes
                    properties:
                      image:
                        description: The image to use for the Elasticsearch nodes
                        type: string
                      resources:
                        description: The resource requirements for the Elasticsearch nodes
                        properties:
                          limits:
                            description: 'Limits describes the maximum amount of compute
                              resources allowed. More info: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/'
                            type: object
                          requests:
                            description: 'Requests describes the minimum amount of compute
                              resources required. If Requests is omitted for a container,
                              it defaults to Limits if that is explicitly specified, otherwise
                              to an implementation-defined value. More info: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/'
                            type: object
  clusterServiceVersions: |-
    - apiVersion: operators.coreos.com/v1alpha1
      kind: ClusterServiceVersion
      metadata:
        name: elasticsearch-operator.v4.2.0
        namespace: openshift-logging
        annotations:
          categories: "OpenShift Optional, Logging & Tracing"
          capabilities: "Seamless Upgrades"
          certified: "false"
          description: |-
            The Elasticsearch Operator for OKD provides a means for configuring and managing an Elasticsearch cluster for tracing and cluster logging.
            ## Prerequisites and Requirements
            ### Elasticsearch Operator Namespace
            The Elasticsearch Operator must be deployed to the global operator group namespace
            ### Memory Considerations
            Elasticsearch is a memory intensive application.  The initial
            set of OKD nodes may not be large enough to support the Elasticsearch cluster.  Additional OKD nodes must be added
            to the OKD cluster if you desire to run with the recommended (or better) memory. Each ES node can operate with a
            lower memory setting though this is not recommended for production deployments.
          containerImage: quay.io/openshift/origin-elasticsearch-operator:latest
          createdAt: 2019-02-20T08:00:00Z
          support: AOS Cluster Logging, Jaeger
          olm.skipRange: ">=4.1.0 <4.2.0"
          alm-examples: |-
              [
                  {
                      "apiVersion": "logging.openshift.io/v1",
                      "kind": "Elasticsearch",
                      "metadata": {
                        "name": "elasticsearch"
                      },
                      "spec": {
                        "managementState": "Managed",
                        "nodeSpec": {
                          "image": "quay.io/openshift/origin-logging-elasticsearch5:latest",
                          "resources": {
                            "limits": {
                              "memory": "1Gi"
                            },
                            "requests": {
                              "memory": "512Mi"
                            }
                          }
                        },
                        "redundancyPolicy": "SingleRedundancy",
                        "nodes": [
                          {
                              "nodeCount": 1,
                              "roles": ["client","data","master"]
                          }
                        ]
                      }
                  }
              ]
      spec:
        version: 4.2.0
        displayName: Elasticsearch Operator

        description: |
          The Elasticsearch Operator for OKD provides a means for configuring and managing an Elasticsearch cluster for use in tracing and cluster logging.
          This operator only supports OKD Cluster Logging and Jaeger.  It is tightly coupled to each and is not currently capable of
          being used as a general purpose manager of Elasticsearch clusters running on OKD.

          It is recommended this operator be deployed to the **openshift-operators** namespace to properly support the Cluster Logging and Jaeger use cases.

          Once installed, the operator provides the following features:
          * **Create/Destroy**: Deploy an Elasticsearch cluster to the same namespace in which the Elasticsearch custom resource is created.

        keywords: ['elasticsearch', 'jaeger']

        maintainers:
        - name: Red Hat, AOS Logging
          email: aos-logging@redhat.com

        provider:
          name: Red Hat, Inc

        links:
        - name: Elastic
          url: https://www.elastic.co/
        - name: Elasticsearch Operator
          url: https://github.com/openshift/elasticsearch-operator
        installModes:
        - type: OwnNamespace
          supported: true
        - type: SingleNamespace
          supported: false
        - type: MultiNamespace
          supported: false
        - type: AllNamespaces
          supported: true
        install:
          strategy: deployment
          spec:
            clusterPermissions:
            - serviceAccountName: elasticsearch-operator
              rules:
              - apiGroups:
                - logging.openshift.io
                resources:
                - "*"
                verbs:
                - "*"
              - apiGroups:
                - ""
                resources:
                - pods
                - pods/exec
                - services
                - endpoints
                - persistentvolumeclaims
                - events
                - configmaps
                - secrets
                - serviceaccounts
                verbs:
                - "*"
              - apiGroups:
                - apps
                resources:
                - deployments
                - daemonsets
                - replicasets
                - statefulsets
                verbs:
                - "*"
              - apiGroups:
                - monitoring.coreos.com
                resources:
                - prometheusrules
                - servicemonitors
                verbs:
                - "*"
              - apiGroups:
                - rbac.authorization.k8s.io
                resources:
                - clusterroles
                - clusterrolebindings
                verbs:
                - "*"
              - nonResourceURLs:
                - "/metrics"
                verbs:
                - get
              - apiGroups:
                - authentication.k8s.io
                resources:
                - tokenreviews
                - subjectaccessreviews
                verbs:
                - create
              - apiGroups:
                - authorization.k8s.io
                resources:
                - subjectaccessreviews
                verbs:
                - create
            deployments:
            - name: elasticsearch-operator
              spec:
                replicas: 1
                selector:
                  matchLabels:
                    name: elasticsearch-operator
                template:
                  metadata:
                    labels:
                      name: elasticsearch-operator
                  spec:
                    serviceAccountName: elasticsearch-operator
                    containers:
                      - name: elasticsearch-operator
                        image: quay.io/openshift/origin-elasticsearch-operator:latest
                        imagePullPolicy: IfNotPresent
                        command:
                        - elasticsearch-operator
                        ports:
                        - containerPort: 60000
                          name: metrics
                        env:
                          - name: WATCH_NAMESPACE
                            valueFrom:
                              fieldRef:
                                fieldPath: metadata.annotations['olm.targetNamespaces']
                          - name: POD_NAME
                            valueFrom:
                              fieldRef:
                                fieldPath: metadata.name
                          - name: OPERATOR_NAME
                            value: "elasticsearch-operator"
                          - name: PROXY_IMAGE
                            value: "quay.io/openshift/origin-oauth-proxy:latest"
                          - name: ELASTICSEARCH_IMAGE
                            value: "quay.io/openshift/origin-logging-elasticsearch5:latest"
        customresourcedefinitions:
          owned:
          - name: elasticsearches.logging.openshift.io
            version: v1
            kind: Elasticsearch
            displayName: Elasticsearch
            description: An Elasticsearch cluster instance
            resources:
            - kind: Deployment
              version: v1
            - kind: StatefulSet
              version: v1
            - kind: ReplicaSet
              version: v1
            - kind: Pod
              version: v1
            - kind: ConfigMap
              version: v1
            - kind: Service
              version: v1
            - kind: Route
              version: v1
            specDescriptors:
            - description: Limits describes the minimum/maximum amount of compute resources required/allowed
              displayName: Resource Requirements
              path: nodeSpec.resources
              x-descriptors:
                - 'urn:alm:descriptor:com.tectonic.ui:resourceRequirements'
            statusDescriptors:
            - description: The current Status of the Elasticsearch Cluster
              displayName: Status
              path: cluster.status
              x-descriptors:
                - 'urn:alm:descriptor:io.kubernetes.phase'
            - description: The number of Active Primary Shards for the Elasticsearch Cluster
              displayName: Active Primary Shards
              path: cluster.activePrimShards
              x-descriptors:
                - 'urn:alm:descriptor:text'
            - description: The number of Active Shards for the Elasticsearch Cluster
              displayName: Active Shards
              path: cluster.activeShards
              x-descriptors:
                - 'urn:alm:descriptor:text'
            - description: The number of Initializing Shards for the Elasticsearch Cluster
              displayName: Initializing Shards
              path: cluster.initializingShards
              x-descriptors:
                - 'urn:alm:descriptor:text'
            - description: The number of Data Nodes for the Elasticsearch Cluster
              displayName: Number of Data Nodes
              path: cluster.numDataNodes
              x-descriptors:
                - 'urn:alm:descriptor:text'
            - description: The number of Nodes for the Elasticsearch Cluster
              displayName: Number of Nodes
              path: cluster.numNodes
              x-descriptors:
                - 'urn:alm:descriptor:text'
            - description: The number of Relocating Shards for the Elasticsearch Cluster
              displayName: Relocating Shards
              path: cluster.relocatingShards
              x-descriptors:
                - 'urn:alm:descriptor:text'
            - description: The number of Unassigned Shards for the Elasticsearch Cluster
              displayName: Unassigned Shards
              path: cluster.unassignedShards
              x-descriptors:
                - 'urn:alm:descriptor:text'
            - description: The status for each of the Elasticsearch pods with the Client role
              displayName: Elasticsearch Client Status
              path: pods.client
              x-descriptors:
              - 'urn:alm:descriptor:com.tectonic.ui:podStatuses'
            - description: The status for each of the Elasticsearch pods with the Data role
              displayName: Elasticsearch Data Status
              path: pods.data
              x-descriptors:
              - 'urn:alm:descriptor:com.tectonic.ui:podStatuses'
            - description: The status for each of the Elasticsearch pods with the Master role
              displayName: Elasticsearch Master Status
              path: pods.master
              x-descriptors:
              - 'urn:alm:descriptor:com.tectonic.ui:podStatuses'
  packages: |-
    - packageName: elasticsearch-operator
      channels:
      - name: "4.2"
        currentCSV: elasticsearch-operator.v4.2.0
